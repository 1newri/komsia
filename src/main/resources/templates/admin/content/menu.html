<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/defaultLayout">

<th:block layout:fragment="content">
	<div class="content pull-right col-lg-9 col-md-8 col-sm-9 col-xs-12 clearfix">
		<ol class="breadcrumb">
			<li class="breadcrumb-item"><a href="/">Home</a></li>
			<li class="breadcrumb-item"><a href="/admin">관리자</a></li>
			<li class="breadcrumb-item active">메뉴관리</li>
		</ol>
		<h2>메뉴관리</h2>
		
		<div class="content col-lg-12 col-md-12 col-sm-12 clearfix">
			<div class="row">
				<div class="col-lg-6 col-md-6 col-sm-12">
					<h4 class="title">
	                   	<span>메뉴등록</span>
	                   </h4>
					<form>
						<fieldset>
							<div class="form-group">
								<label for="pid">상위메뉴</label>
								<select class="form-control" id="pid">
									<option th:each="item : ${list}" th:value="${item.menuId}" th:data-url="${item.url}" th:data-level="${item.level}" th:text="${item.name}"></option>
								</select>
								<input type="hidden" id="level" name="level">
							</div>
							<div class="form-group">
								<label for="url">URL</label>
								<input type="text" class="form-control" id="url" name="url">
							</div>
							<div class="form-group">
								<label for="name">메뉴명</label>
								<input type="text" class="form-control" id="name" name="name">
							</div>
							<div class="form-group">
								<label for="type">타입</label>
								<select class="form-control" id="type">
									<option value="M">메뉴</option>
									<option value="A">Ajax</option>
								</select>
							</div>
							<div class="form-group">
								<label for="description">설명</label>
								<input type="text" class="form-control" id="description" name="description">
							</div>
							<div class="form-group">
								<label for="ordering">메뉴순번</label>
								<input type="text" class="form-control" id="ordering" name="ordering">
							</div>
						</fieldset>
						<button type="button" id="save" class="btn btn-primary">등록</button>
					</form>
				</div>
				<div class="col-lg-6 col-md-6 col-sm-12">
					<h4 class="title">
	                  	<span>메뉴목록</span>
	               </h4>
	               <div class="menu-list">
				       	<ul>
							<li th:each="list : ${menuList}" th:class="|level-${list.level}|">
								<a th:href="${list.url}" th:text="${list.name}" th:data-menuid="${list.menuId}"></a>
							</li>
						</ul>
	               </div>
				</div>
			</div>
		</div>
	</div>
      <!-- end content -->
	<script>
		$(function(){
			fn_init();
			
			$("#pid").change(function(){
				var url = $(this).find("option:selected").data("url");
				var level = $(this).find("option:selected").data("level");
				$("#url").val(url);
				$("#level").val(level);
			})
			
			
			var table = $("#menuTable").DataTable({
				searching : false
				, pageLength : 10
				, ordering : false
				, serverSide : true
				, language : lang_kor
				, dom : ''
				, ajax : {
					'url' : "/admin/menu/list",
					'type': 'POST'
				}, columns : [
					{
						data : "menuId", className: 'text-center'
						, render : function(data, type, row, meta){
							return meta.row + meta.settings._iDisplayStart + 1;
						}
					},{ data : "pid" , className: 'text-center'}
					,{ data : "url" , className: 'text-left'}
					,{ data : "name", className: 'text-left'}
					,{ data : "description", className: 'text-left'}
					,{ data : "ordering", className: 'text-center'}
					,{ data : "type", className: 'text-center'}
					,{ data : "useYn", className: 'text-center'}
				]
      		});
	      		
      		$("#save").click(function(){
      			
      			$.ajax({
      				url: "/admin/menu/save"
					, type : "POST"
      				, data : {
      					pid : $("#pid option:selected").val()
      					, url : $("#url").val()
      					, name : $("#name").val()
      					, type : $("#type option:selected").val()
      					, description : $("#description").val()
      					, ordering : $("#ordering").val()
      					, level : $("#level").val()
      				}, success : function(data){
      					var json = JSON.parse(data);
      					if(json.resCode == "0000"){
      						table.ajax.reload();
      						fn_init();
							alert(json.resMsg);
      					}
      				}, error : function(request, status, error){
      					alert("시스템 오류가 발생하였습니다. 관리자에게 문의하세요.");
      				}
      			});
      		});
		});
      	
		
      	function fn_init(){
      		$("input").val('');
      		$("select option:first").attr("selected", true);
      		$("#url").val('/');
      	}
	</script>
</th:block>
</html>